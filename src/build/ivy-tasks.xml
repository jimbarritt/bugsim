<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="ivy-targets" xmlns:ivy="antlib:org.apache.ivy.ant">

    <property name="override.message" value="should be set this in your build.xml" />
    <property name="lib.dir" value="lib.dir ${override.message}" />
    <property name="lib.build.dir" value="lib.build.dir ${override.message}" />
    <property name="ivy.dependency.file" value="ivy.dependency.file ${override.message}" />
    <property name="ivy.dependency.file" value="ivy.settings.file ${override.message}" />
    <property name="lib.production.dir" value="lib.production.dir ${override.message}" />


    <property name="ivy.install.version" value="2.0.0-beta1" />   
    <property name="ivy.jar.dir" value="${lib.build.dir}/ivy" />   
    <property name="ivy.jar.file" value="${ivy.jar.dir}/ivy.jar" />
   
    <property name="ivy.download.url" value="http://repo1.maven.org/maven2/org/apache/ivy/ivy/${ivy.install.version}/ivy-${ivy.install.version}.jar" />


    <path id="ivy.classpath">
        <fileset dir="${ivy.jar.dir}" includes="*.jar"/>
    </path>

    <!-- ======================================================================================================== -->
    <!-- ivy targets (ivy.download, ivy.install, ivy.download.dependancies) -->
    <!-- ======================================================================================================== -->
    <target name="ivy.download" unless="skip.download">
        <mkdir dir="${lib.dir}" />
        <mkdir dir="${ivy.jar.dir}"/>
        <echo message="Downloading ivy from ${ivy.download.url}..."/>
    	<get src="${ivy.download.url}"
    		 dest="${ivy.jar.file}" usetimestamp="true"/>
    </target>


    <target name="ivy.install" >
        <taskdef resource="org/apache/ivy/ant/antlib.xml"
    	          uri="antlib:org.apache.ivy.ant" classpathref="ivy.classpath"/>
        <ivy:settings file="${ivy.settings.file}" />
    </target>


    <target name="lib.update" depends="ivy.install">
        <ivy:retrieve file="${ivy.dependency.file}"
                      pattern="${lib.production.dir}/[type]/[artifact]-[revision].[ext]" />			    
	</target>

    <!-- Looks at your dependency file and builds classpath from there, but its a bit slow -->
    <target name="ivy.cache.path" depends="ivy.install">
        <ivy:cachepath  file="${ivy.dependency.file}" conf="main" type="jar"
                        pathid="classpath.main"/>
    </target>

    <available file="${lib.dir}" property="lib.dir.exists"/>

    <target name="ivy.echo.lib.dir" if="lib.dir.exists">
        <echo message="lib dir [${lib.dir}] exists, not downloading libs." />
        <echo message="Use the lib.update target to download the libs." />
    </target>

    <target name="ivy.check.configure" depends="ivy.echo.lib.dir" unless="lib.dir.exists">
        <antcall target="ivy.download"/>
        <antcall target="lib.update" />
    </target>

    <target name="clean.ivy">
		<delete file="${ivy.jar.file}"/>
	</target>

    <target name="clean.ivy.cache" depends="ivy.install">
		<ivy:cleancache />
	</target>

    
</project>